(function(a){a.Dill={};a.Dill.init=function(){a.Dill.current_url=a.Dill.parseUri(document.location.href);if(a.Dill.init_done){return}a.Dill.initialState.url=a.Dill.current_url;a.Dill.initialState.title=document.title;a.Dill.page_cache[a.Dill.current_url.full]=a("html").html();a.Dill.init_done=true;a.Dill.all()};a.Dill.initialState={};a.Dill.page_cache={};a.Dill.parseUri=function(f){var e={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},b=e.parser[e.strictMode?"strict":"loose"].exec(f),d={},c=14;while(c--){d[e.key[c]]=b[c]||""}d[e.q.name]={};d[e.key[12]].replace(e.q.parser,function(h,g,i){if(g){d[e.q.name][g]=i}});if(a.Dill.current_url){if(d.host==""){d.protocol=(d.protocol!="")?d.protocol:((a.Dill.current_url.protocol=="")?"http":a.Dill.current_url.protocol);d.host=a.Dill.current_url.host;d.port=(d.port!="")?d.port:((a.Dill.current_url.port=="")?"":a.Dill.current_url.port);d.path=(d.path!="")?d.path:((a.Dill.current_url.path=="")?"":a.Dill.current_url.path)}}d.full=d.protocol+"://"+d.host+((d.port=="")?"":":"+d.port)+((d.path=="")?"/":d.path)+((d.query=="")?"":"?"+d.query);d.full_anchor=d.full;if(d.anchor>""){d.full_anchor+="#"+d.anchor}return d};a.Dill.applyTo=function(){var c=a.data(a(this).get(0),"events");if(c&&!a(this).data("url")&&c.click){return}a(this).unbind("click");var b=a.Dill.parseUri(a(this).attr("href"));if(b.host!=a.Dill.current_url.host){return}a(this).data("url",b);a(this).click(function(d){if((a.browser.msie&&d.button!=1)||(!a.browser.msie&&d.button!=0)||(d.ctrlKey)){return}d.preventDefault();a.Dill.loadURL(a(this).data("url"))})};a.Dill.loadURL=function(b){if(b.host!=a.Dill.current_url.host){return}if(a.Dill.current_url.full==b.full){a.Dill.gotoAnchor(b.anchor);return}a.get(b.full,function(c){a.Dill.page_cache[b.full]=c;a.Dill.updateHistory(b);a.Dill.applyData(b)},"html")};a.Dill.applyData=function(d){var f=a.Dill.page_cache[d.full];if(!f){a.get(d.full,function(h){a.Dill.page_cache[d.full]=h;a.Dill.applyData(d)},"html");return}if(!a.Dill.container){a("html").html(f)}else{if(typeof a.Dill.container=="string"){a.Dill.container=[a.Dill.container]}var c,g,b=a.Dill.container.length;for(var e=0;e<b;e++){g=a(a.Dill.container[e]+":first",f);c=a(a.Dill.container[e]+":first");c.replaceWith(g);c.height(c.height());c.height("auto")}}a.Dill.all();a.Dill.pageChange_run();a.Dill.gotoAnchor(d.anchor)};a.Dill.updateHistory=function(b){var c=a.Dill.page_cache[b.full];var d=c.match(/<title>(.*?)<\/title>/)[1];history.pushState({url:b,title:d},d,b.relative);document.title=d;a.Dill.init()};a.Dill.gotoAnchor=function(b){if(b==""){b=0}else{b=a("#"+b+":first, a[name="+b+"]:first");if(b.length==0){return}b=b.offset().top}var c;if(a.browser.webkit){c=a("body")}else{c=a("html,body")}if(c.scrollTop()!=b){c.animate({scrollTop:b},"fast")}};a.Dill.all=function(){a("a[target!=_blank]").each(a.Dill.applyTo)};a.Dill.pageChange_run=function(){var b=a.Dill.pageChange_funcs.length;for(var c=0;c<b;c++){a.Dill.pageChange_funcs[c]()}};a.Dill.pageChange_funcs=[];a.Dill.pageChange=function(b){a.Dill.pageChange_funcs.push(b)};a(document).ready(a.Dill.init);a(window).bind("popstate",function(c){if(a.browser.webkit&&!a.Dill.init_pop){a.Dill.init_pop=true;return}var b=c.originalEvent.state;if(!b){b=a.Dill.initialState}if(b.url.full!=a.Dill.current_url.full){document.title=b.title;a.Dill.init();a.Dill.applyData(b.url)}})})(jQuery);